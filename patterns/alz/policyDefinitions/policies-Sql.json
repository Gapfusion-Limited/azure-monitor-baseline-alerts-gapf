{
  "$schema": "https://schema.management.azure.com/schemas/2019-08-01/managementGroupDeploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.38.33.27573",
      "templateHash": "11925283120167576531"
    }
  },
  "parameters": {
    "topLevelManagementGroupPrefix": {
      "type": "string",
      "defaultValue": "alz",
      "metadata": {
        "message": "The JSON version of this file is programatically generated from Bicep. PLEASE DO NOT UPDATE MANUALLY!!",
        "description": "Provide a prefix (unique at tenant-scope) for the Management Group hierarchy and other resources created as part of an Azure landing zone. DEFAULT VALUE = \"alz\""
      }
    },
    "location": {
      "type": "string",
      "defaultValue": "[deployment().location]",
      "metadata": {
        "description": "Optionally set the deployment location for policies with Deploy If Not Exists effect. DEFAULT VALUE = \"deployment().location\""
      }
    },
    "scope": {
      "type": "string",
      "defaultValue": "[tenantResourceId('Microsoft.Management/managementGroups', parameters('topLevelManagementGroupPrefix'))]",
      "metadata": {
        "description": "Optionally set the scope for custom Policy Definitions used in Policy Set Definitions (Initiatives). Must be one of '/', '/subscriptions/id' or '/providers/Microsoft.Management/managementGroups/id'. DEFAULT VALUE = '/providers/Microsoft.Management/managementGroups/${topLevelManagementGroupPrefix}'"
      }
    }
  },
  "variables": {
    "copy": [
      {
        "name": "processPolicyDefinitionsAll",
        "count": "[length(variables('loadPolicyDefinitions').All)]",
        "input": "[replace(replace(variables('loadPolicyDefinitions').All[copyIndex('processPolicyDefinitionsAll')], variables('templateVars').defaultDeploymentLocation, variables('deploymentLocation')), variables('templateVars').localizedDeploymentLocation, variables('deploymentLocation'))]"
      },
      {
        "name": "processPolicyDefinitionsAzureCloud",
        "count": "[length(variables('loadPolicyDefinitions').AzureCloud)]",
        "input": "[replace(replace(variables('loadPolicyDefinitions').AzureCloud[copyIndex('processPolicyDefinitionsAzureCloud')], variables('templateVars').defaultDeploymentLocation, variables('deploymentLocation')), variables('templateVars').localizedDeploymentLocation, variables('deploymentLocation'))]"
      },
      {
        "name": "processPolicyDefinitionsAzureChinaCloud",
        "count": "[length(variables('loadPolicyDefinitions').AzureChinaCloud)]",
        "input": "[replace(replace(variables('loadPolicyDefinitions').AzureChinaCloud[copyIndex('processPolicyDefinitionsAzureChinaCloud')], variables('templateVars').defaultDeploymentLocation, variables('deploymentLocation')), variables('templateVars').localizedDeploymentLocation, variables('deploymentLocation'))]"
      },
      {
        "name": "processPolicyDefinitionsAzureUSGovernment",
        "count": "[length(variables('loadPolicyDefinitions').AzureUSGovernment)]",
        "input": "[replace(replace(variables('loadPolicyDefinitions').AzureUSGovernment[copyIndex('processPolicyDefinitionsAzureUSGovernment')], variables('templateVars').defaultDeploymentLocation, variables('deploymentLocation')), variables('templateVars').localizedDeploymentLocation, variables('deploymentLocation'))]"
      },
      {
        "name": "processPolicySetDefinitionsAll",
        "count": "[length(variables('loadPolicySetDefinitions').All)]",
        "input": "[replace(variables('loadPolicySetDefinitions').All[copyIndex('processPolicySetDefinitionsAll')], variables('templateVars').scope, parameters('scope'))]"
      },
      {
        "name": "processPolicySetDefinitionsAzureCloud",
        "count": "[length(variables('loadPolicySetDefinitions').AzureCloud)]",
        "input": "[replace(variables('loadPolicySetDefinitions').AzureCloud[copyIndex('processPolicySetDefinitionsAzureCloud')], variables('templateVars').scope, parameters('scope'))]"
      },
      {
        "name": "processPolicySetDefinitionsAzureChinaCloud",
        "count": "[length(variables('loadPolicySetDefinitions').AzureChinaCloud)]",
        "input": "[replace(variables('loadPolicySetDefinitions').AzureChinaCloud[copyIndex('processPolicySetDefinitionsAzureChinaCloud')], variables('templateVars').scope, parameters('scope'))]"
      },
      {
        "name": "processPolicySetDefinitionsAzureUSGovernment",
        "count": "[length(variables('loadPolicySetDefinitions').AzureUSGovernment)]",
        "input": "[replace(variables('loadPolicySetDefinitions').AzureUSGovernment[copyIndex('processPolicySetDefinitionsAzureUSGovernment')], variables('templateVars').scope, parameters('scope'))]"
      },
      {
        "name": "policyDefinitionsAll",
        "count": "[length(variables('processPolicyDefinitionsAll'))]",
        "input": "[json(variables('processPolicyDefinitionsAll')[copyIndex('policyDefinitionsAll')])]"
      },
      {
        "name": "policyDefinitionsAzureCloud",
        "count": "[length(variables('processPolicyDefinitionsAzureCloud'))]",
        "input": "[json(variables('processPolicyDefinitionsAzureCloud')[copyIndex('policyDefinitionsAzureCloud')])]"
      },
      {
        "name": "policyDefinitionsAzureChinaCloud",
        "count": "[length(variables('processPolicyDefinitionsAzureChinaCloud'))]",
        "input": "[json(variables('processPolicyDefinitionsAzureChinaCloud')[copyIndex('policyDefinitionsAzureChinaCloud')])]"
      },
      {
        "name": "policyDefinitionsAzureUSGovernment",
        "count": "[length(variables('processPolicyDefinitionsAzureUSGovernment'))]",
        "input": "[json(variables('processPolicyDefinitionsAzureUSGovernment')[copyIndex('policyDefinitionsAzureUSGovernment')])]"
      },
      {
        "name": "policySetDefinitionsAll",
        "count": "[length(variables('processPolicySetDefinitionsAll'))]",
        "input": "[json(variables('processPolicySetDefinitionsAll')[copyIndex('policySetDefinitionsAll')])]"
      },
      {
        "name": "policySetDefinitionsAzureCloud",
        "count": "[length(variables('processPolicySetDefinitionsAzureCloud'))]",
        "input": "[json(variables('processPolicySetDefinitionsAzureCloud')[copyIndex('policySetDefinitionsAzureCloud')])]"
      },
      {
        "name": "policySetDefinitionsAzureChinaCloud",
        "count": "[length(variables('processPolicySetDefinitionsAzureChinaCloud'))]",
        "input": "[json(variables('processPolicySetDefinitionsAzureChinaCloud')[copyIndex('policySetDefinitionsAzureChinaCloud')])]"
      },
      {
        "name": "policySetDefinitionsAzureUSGovernment",
        "count": "[length(variables('processPolicySetDefinitionsAzureUSGovernment'))]",
        "input": "[json(variables('processPolicySetDefinitionsAzureUSGovernment')[copyIndex('policySetDefinitionsAzureUSGovernment')])]"
      }
    ],
    "$fxv#0": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"d26f4c8b-0461-4c57-b230-cbd1a5424db1\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Sql servers databases dtu_used Alert\",\r\n    \"description\": \"Policy to Audit/Deploy Sql servers databases dtu_used Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.0.0-preview\",\r\n      \"category\": \"Sql\",\r\n      \"preview\": true,\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"2\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT1M\",\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"P1D\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT1M\",\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"80\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Monitoring disabled tag name\",\r\n          \"description\": \"Tag name used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers/databases\"\r\n          },\r\n          {\r\n            \"field\": \"Microsoft.Sql/servers/databases/sku.tier\",\r\n            \"in\": [ \"Basic\", \"Standard\", \"Premium\" ]\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/metricAlerts\",\r\n          \"name\": \"[[concat(replace(field('fullName'),'/','-'), '-dtu_used')]\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricNamespace\",\r\n                \"equals\": \"Microsoft.Sql/servers/databases\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricName\",\r\n                \"equals\": \"dtu_used\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricalerts/scopes[*]\",\r\n                \"equals\": \"[[field('id')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricalerts/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft-Azure-Monitor-SingleResourceMultipleMetricCriteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"Average\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].StaticThresholdCriterion.operator\",\r\n                \"equals\": \"GreaterThan\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].StaticThresholdCriterion.threshold\",\r\n                \"equals\": \"[[if(contains(field('tags'), '_amba-dtu_used-threshold-Override_'), field('tags._amba-dtu_used-threshold-Override_'), parameters('threshold'))]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"resourceName\": {\r\n                    \"type\": \"String\",\r\n                    \"metadata\": {\r\n                      \"displayName\": \"resourceName\",\r\n                      \"description\": \"Name of the resource\"\r\n                    }\r\n                  },\r\n                  \"resourceId\": {\r\n                    \"type\": \"String\",\r\n                    \"metadata\": {\r\n                      \"displayName\": \"resourceId\",\r\n                      \"description\": \"Resource ID of the resource emitting the metric that will be used for the comparison\"\r\n                    }\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Insights/metricAlerts\",\r\n                    \"apiVersion\": \"2018-03-01\",\r\n                    \"name\": \"[[concat(parameters('resourceName'), '-dtu_used')]\",\r\n                    \"location\": \"global\",\r\n                    \"tags\": {\r\n                      \"_deployed_by_amba\": true\r\n                    },\r\n                    \"properties\": {\r\n                      \"description\": \"Metric Alert for Sql servers databases dtu_used\",\r\n                      \"severity\": \"[[parameters('severity')]\",\r\n                      \"enabled\": \"[[parameters('enabled')]\",\r\n                      \"scopes\": [\r\n                        \"[[parameters('resourceId')]\"\r\n                      ],\r\n                      \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                      \"windowSize\": \"[[parameters('windowSize')]\",\r\n                      \"criteria\": {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"name\": \"dtu_used\",\r\n                            \"metricNamespace\": \"Microsoft.Sql/servers/databases\",\r\n                            \"metricName\": \"dtu_used\",\r\n                            \"operator\": \"GreaterThan\",\r\n                            \"threshold\": \"[[parameters('threshold')]\",\r\n                            \"timeAggregation\": \"Average\",\r\n                            \"criterionType\": \"StaticThresholdCriterion\"\r\n                          }\r\n                        ],\r\n                        \"odata.type\": \"Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria\"\r\n                      },\r\n                      \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                      \"parameters\": {\r\n                        \"severity\": {\r\n                          \"value\": \"[[parameters('severity')]\"\r\n                        },\r\n                        \"windowSize\": {\r\n                          \"value\": \"[[parameters('windowSize')]\"\r\n                        },\r\n                        \"evaluationFrequency\": {\r\n                          \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                        },\r\n                        \"autoMitigate\": {\r\n                          \"value\": \"[[parameters('autoMitigate')]\"\r\n                        },\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"threshold\": {\r\n                          \"value\": \"[[parameters('threshold')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"resourceName\": {\r\n                  \"value\": \"[[replace(field('fullName'),'/','-')]\"\r\n                },\r\n                \"resourceId\": {\r\n                  \"value\": \"[[field('id')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[if(contains(field('tags'), '_amba-dtu_used-threshold-Override_'), field('tags._amba-dtu_used-threshold-Override_'), parameters('threshold'))]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#1": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"86922a27-41bb-4834-bc54-0b602b275597\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Sql servers databases storage percentage used Alert\",\r\n    \"description\": \"Policy to Audit/Deploy Sql servers databases storage percentage used Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.0.0-preview\",\r\n      \"category\": \"Sql\",\r\n      \"preview\": true,\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"2\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT1M\",\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"P1D\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT1M\",\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"80\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Monitoring disabled tag name\",\r\n          \"description\": \"Tag name used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers/databases\"\r\n          },\r\n          {\r\n            \"field\": \"Microsoft.Sql/servers/databases/sku.tier\",\r\n            \"in\": [\r\n              \"Basic\",\r\n              \"Standard\",\r\n              \"Premium\",\r\n              \"GeneralPurpose\",\r\n              \"BusinessCritical\",\r\n              \"Hyperscale\"\r\n            ]\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/metricAlerts\",\r\n          \"name\": \"[[concat(replace(field('fullName'),'/','-'), '-storage-percent')]\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricNamespace\",\r\n                \"equals\": \"Microsoft.Sql/servers/databases\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricName\",\r\n                \"equals\": \"storage_percent\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricalerts/scopes[*]\",\r\n                \"equals\": \"[[field('id')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricalerts/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft-Azure-Monitor-SingleResourceMultipleMetricCriteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"Average\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].StaticThresholdCriterion.operator\",\r\n                \"equals\": \"GreaterThan\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].StaticThresholdCriterion.threshold\",\r\n                \"equals\": \"[[if(contains(field('tags'), '_amba-storage-percentage-threshold-Override_'), field('tags._amba-storage-percentage-threshold-Override_'), parameters('threshold'))]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"resourceName\": {\r\n                    \"type\": \"String\",\r\n                    \"metadata\": {\r\n                      \"displayName\": \"resourceName\",\r\n                      \"description\": \"Name of the resource\"\r\n                    }\r\n                  },\r\n                  \"resourceId\": {\r\n                    \"type\": \"String\",\r\n                    \"metadata\": {\r\n                      \"displayName\": \"resourceId\",\r\n                      \"description\": \"Resource ID of the resource emitting the metric that will be used for the comparison\"\r\n                    }\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Insights/metricAlerts\",\r\n                    \"apiVersion\": \"2018-03-01\",\r\n                    \"name\": \"[[concat(parameters('resourceName'), '-storage-percentage')]\",\r\n                    \"location\": \"global\",\r\n                    \"tags\": {\r\n                      \"_deployed_by_amba\": true\r\n                    },\r\n                    \"properties\": {\r\n                      \"description\": \"Metric Alert for Sql servers databases storage percentage used\",\r\n                      \"severity\": \"[[parameters('severity')]\",\r\n                      \"enabled\": \"[[parameters('enabled')]\",\r\n                      \"scopes\": [\r\n                        \"[[parameters('resourceId')]\"\r\n                      ],\r\n                      \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                      \"windowSize\": \"[[parameters('windowSize')]\",\r\n                      \"criteria\": {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"name\": \"storage_percent\",\r\n                            \"metricNamespace\": \"Microsoft.Sql/servers/databases\",\r\n                            \"metricName\": \"storage_percent\",\r\n                            \"operator\": \"GreaterThan\",\r\n                            \"threshold\": \"[[parameters('threshold')]\",\r\n                            \"timeAggregation\": \"Average\",\r\n                            \"criterionType\": \"StaticThresholdCriterion\"\r\n                          }\r\n                        ],\r\n                        \"odata.type\": \"Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria\"\r\n                      },\r\n                      \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                      \"parameters\": {\r\n                        \"severity\": {\r\n                          \"value\": \"[[parameters('severity')]\"\r\n                        },\r\n                        \"windowSize\": {\r\n                          \"value\": \"[[parameters('windowSize')]\"\r\n                        },\r\n                        \"evaluationFrequency\": {\r\n                          \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                        },\r\n                        \"autoMitigate\": {\r\n                          \"value\": \"[[parameters('autoMitigate')]\"\r\n                        },\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"threshold\": {\r\n                          \"value\": \"[[parameters('threshold')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"resourceName\": {\r\n                  \"value\": \"[[replace(field('fullName'),'/','-')]\"\r\n                },\r\n                \"resourceId\": {\r\n                  \"value\": \"[[field('id')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[if(contains(field('tags'), '_amba-storage-percentage-threshold-Override_'), field('tags._amba-storage-percentage-threshold-Override_'), parameters('threshold'))]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#10": {
      "type": "Microsoft.Authorization/policySetDefinitions",
      "apiVersion": "2021-06-01",
      "name": "Alerting-Sql",
      "properties": {
        "displayName": "Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) for SQL",
        "description": "This initiative deploys Azure Monitor Baseline Alerts (AMBA-ALZ) to monitor SQL Services such as SQL databases, Elastic Pools, Managed Instances.",
        "metadata": {
          "version": "1.0.0",
          "category": "Monitoring",
          "source": "https://github.com/Azure/azure-monitor-baseline-alerts/",
          "alzCloudEnvironments": [
            "AzureCloud"
          ],
          "_deployed_by_amba": true
        },
        "parameters": {
          "ALZMonitorResourceGroupName": {
            "type": "String",
            "defaultValue": "rg-amba-monitoring-001",
            "metadata": {
              "displayName": "ALZ Monitor Resource Group Name",
              "description": "Name of the resource group where the ALZ Monitor resources will be deployed"
            }
          },
          "ALZMonitorResourceGroupTags": {
            "type": "Object",
            "defaultValue": {
              "_deployed_by_alz_monitor": true
            },
            "metadata": {
              "displayName": "ALZ Monitor Resource Group Tags",
              "description": "Tags for the resource group where the ALZ Monitor resources will be deployed"
            }
          },
          "ALZMonitorResourceGroupLocation": {
            "type": "String",
            "defaultValue": "centralus",
            "metadata": {
              "displayName": "ALZ Monitor Resource Group Location",
              "description": "Location of the resource group where the ALZ Monitor resources will be deployed"
            }
          },
          "ALZMonitorDisableTagName": {
            "type": "String",
            "metadata": {
              "displayName": "ALZ Monitoring disabled tag name",
              "description": "Tag name used to disable monitoring at the resource level. Set to true if monitoring should be disabled."
            },
            "defaultValue": "MonitorDisable"
          },
          "ALZMonitorDisableTagValues": {
            "type": "Array",
            "metadata": {
              "displayName": "ALZ Monitoring disabled tag values(s)",
              "description": "Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled."
            },
            "defaultValue": [
              "true",
              "Test",
              "Dev",
              "Sandbox"
            ]
          },
          "SqlDtuUsedAlertSeverity": {
            "type": "String",
            "metadata": {
              "displayName": "SqlDtuUsed Severity",
              "description": "Severity of the SqlDtuUsed Alert"
            },
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "defaultValue": "3"
          },
          "SqlDtuUsedWindowSize": {
            "type": "String",
            "metadata": {
              "displayName": "SqlDtuUsed Window Size",
              "description": "SqlDtuUsed Window size for the alert"
            },
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "defaultValue": "PT5M"
          },
          "SqlDtuUsedEvaluationFrequency": {
            "type": "String",
            "metadata": {
              "displayName": "SqlDtuUsed Evaluation Frequency",
              "description": "SqlDtuUsed Evaluation frequency for the alert"
            },
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "defaultValue": "PT5M"
          },
          "SqlDtuUsedAutoMitigate": {
            "type": "String",
            "metadata": {
              "displayName": "SqlDtuUsed Auto Mitigate",
              "description": "Auto Mitigate for the SqlDtuUsed alert"
            },
            "allowedValues": [
              "true",
              "false"
            ],
            "defaultValue": "true"
          },
          "SqlDtuUsedAlertEnabled": {
            "type": "String",
            "metadata": {
              "displayName": "SqlDtuUsed Alert State",
              "description": "Alert state for the SqlDtuUsed alert"
            },
            "allowedValues": [
              "true",
              "false"
            ],
            "defaultValue": "true"
          },
          "SqlDtuUsedThreshold": {
            "type": "String",
            "metadata": {
              "displayName": "SqlDtuUsed Threshold",
              "description": "Threshold for the SqlDtuUsed alert"
            },
            "defaultValue": "80"
          },
          "SqlDtuUsedPolicyEffect": {
            "type": "String",
            "metadata": {
              "displayName": "SqlDtuUsed Policy Effect",
              "description": "Effect of the SqlDtuUsed policy"
            },
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "defaultValue": "deployIfNotExists"
          },
          "SqlDataSpaceUsedAlertSeverity": {
            "type": "String",
            "metadata": {
              "displayName": "Severity",
              "description": "Severity of the SqlDataSpaceUsed Alert"
            },
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "defaultValue": "2"
          },
          "SqlDataSpaceUsedWindowSize": {
            "type": "String",
            "metadata": {
              "displayName": "Window Size",
              "description": "Window size for the SqlDataSpaceUsed alert"
            },
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "defaultValue": "PT5M"
          },
          "SqlDataSpaceUsedEvaluationFrequency": {
            "type": "String",
            "metadata": {
              "displayName": "Evaluation Frequency",
              "description": "Evaluation frequency for the SqlDataSpaceUsed alert"
            },
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "defaultValue": "PT5M"
          },
          "SqlDataSpaceUsedAutoMitigate": {
            "type": "String",
            "metadata": {
              "displayName": "Auto Mitigate",
              "description": "Auto Mitigate for the SqlDataSpaceUsed alert"
            },
            "allowedValues": [
              "true",
              "false"
            ],
            "defaultValue": "true"
          },
          "SqlDataSpaceUsedAlertEnabled": {
            "type": "String",
            "metadata": {
              "displayName": "Alert State",
              "description": "Alert state for the SqlDataSpaceUsed alert"
            },
            "allowedValues": [
              "true",
              "false"
            ],
            "defaultValue": "true"
          },
          "SqlDataSpaceUsedThreshold": {
            "type": "String",
            "metadata": {
              "displayName": "Threshold",
              "description": "Threshold for the SqlDataSpaceUsed alert"
            },
            "defaultValue": "80"
          },
          "SqlDataSpaceUsedPolicyEffect": {
            "type": "String",
            "metadata": {
              "displayName": "Effect",
              "description": "Effect of the SqlDataSpaceUsed policy"
            },
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "defaultValue": "deployIfNotExists"
          },
          "SqlDeadlockAlertSeverity": {
            "type": "String",
            "metadata": {
              "displayName": "Severity",
              "description": "Severity of the SqlDeadlock Alert"
            },
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "defaultValue": "3"
          },
          "SqlDeadlockWindowSize": {
            "type": "String",
            "metadata": {
              "displayName": "Window Size",
              "description": "Window size for the SqlDeadlock alert"
            },
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "defaultValue": "PT5M"
          },
          "SqlDeadlockEvaluationFrequency": {
            "type": "String",
            "metadata": {
              "displayName": "Evaluation Frequency",
              "description": "Evaluation frequency for the SqlDeadlock alert"
            },
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "defaultValue": "PT1M"
          },
          "SqlDeadlockAutoMitigate": {
            "type": "String",
            "metadata": {
              "displayName": "Auto Mitigate",
              "description": "Auto Mitigate for the SqlDeadlock alert"
            },
            "allowedValues": [
              "true",
              "false"
            ],
            "defaultValue": "true"
          },
          "SqlDeadlockAlertEnabled": {
            "type": "String",
            "metadata": {
              "displayName": "Alert State",
              "description": "Alert state for the SqlDeadlock alert"
            },
            "allowedValues": [
              "true",
              "false"
            ],
            "defaultValue": "true"
          },
          "SqlDeadlockThreshold": {
            "type": "String",
            "metadata": {
              "displayName": "Threshold",
              "description": "Threshold for the alert"
            },
            "defaultValue": "1"
          },
          "SqlDeadlockPolicyEffect": {
            "type": "String",
            "metadata": {
              "displayName": "Effect",
              "description": "Effect of the SqlDeadlock policy"
            },
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "defaultValue": "deployIfNotExists"
          },
          "SqlDtuConsumptionPercentAlertSeverity": {
            "type": "String",
            "metadata": {
              "displayName": "Severity",
              "description": "Severity of the SqlDtuConsumptionPercent Alert"
            },
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "defaultValue": "2"
          },
          "SqlDtuConsumptionPercentWindowSize": {
            "type": "String",
            "metadata": {
              "displayName": "Window Size",
              "description": "Window size for the SqlDtuConsumptionPercent alert"
            },
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "defaultValue": "PT5M"
          },
          "SqlDtuConsumptionPercentEvaluationFrequency": {
            "type": "String",
            "metadata": {
              "displayName": "Evaluation Frequency",
              "description": "Evaluation frequency for the SqlDtuConsumptionPercent alert"
            },
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "defaultValue": "PT1M"
          },
          "SqlDtuConsumptionPercentAutoMitigate": {
            "type": "String",
            "metadata": {
              "displayName": "Auto Mitigate",
              "description": "Auto Mitigate for the SqlDtuConsumptionPercent alert"
            },
            "allowedValues": [
              "true",
              "false"
            ],
            "defaultValue": "true"
          },
          "SqlDtuConsumptionPercentAlertEnabled": {
            "type": "String",
            "metadata": {
              "displayName": "Alert State",
              "description": "Alert state for the SqlDtuConsumptionPercent alert"
            },
            "allowedValues": [
              "true",
              "false"
            ],
            "defaultValue": "true"
          },
          "SqlDtuConsumptionPercentThreshold": {
            "type": "String",
            "metadata": {
              "displayName": "Threshold",
              "description": "Threshold for the SqlDtuConsumptionPercent alert"
            },
            "defaultValue": "80"
          },
          "SqlDtuConsumptionPercentPolicyEffect": {
            "type": "String",
            "metadata": {
              "displayName": "Effect",
              "description": "Effect of the SqlDtuConsumptionPercent policy"
            },
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "defaultValue": "deployIfNotExists"
          },
          "SqlElasticCpuPercentAlertSeverity": {
            "type": "String",
            "metadata": {
              "displayName": "Severity",
              "description": "Severity of the SqlElasticCpuPercent Alert"
            },
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "defaultValue": "2"
          },
          "SqlElasticCpuPercentWindowSize": {
            "type": "String",
            "metadata": {
              "displayName": "Window Size",
              "description": "Window size for the SqlElasticCpuPercent alert"
            },
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "defaultValue": "PT5M"
          },
          "SqlElasticCpuPercentEvaluationFrequency": {
            "type": "String",
            "metadata": {
              "displayName": "Evaluation Frequency",
              "description": "Evaluation frequency for the SqlElasticCpuPercent alert"
            },
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "defaultValue": "PT1M"
          },
          "SqlElasticCpuPercentAutoMitigate": {
            "type": "String",
            "metadata": {
              "displayName": "Auto Mitigate",
              "description": "Auto Mitigate for the SqlElasticCpuPercent alert"
            },
            "allowedValues": [
              "true",
              "false"
            ],
            "defaultValue": "true"
          },
          "SqlElasticCpuPercentAlertEnabled": {
            "type": "String",
            "metadata": {
              "displayName": "Alert State",
              "description": "Alert state for the SqlElasticCpuPercent alert"
            },
            "allowedValues": [
              "true",
              "false"
            ],
            "defaultValue": "true"
          },
          "SqlElasticCpuPercentThreshold": {
            "type": "String",
            "metadata": {
              "displayName": "Threshold",
              "description": "Threshold for the SqlElasticCpuPercent alert"
            },
            "defaultValue": "90"
          },
          "SqlElasticCpuPercentPolicyEffect": {
            "type": "String",
            "metadata": {
              "displayName": "Effect",
              "description": "Effect of the SqlElasticCpuPercent policy"
            },
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "defaultValue": "deployIfNotExists"
          },
          "SqlElasticDtuConsumptionPercentAlertSeverity": {
            "type": "String",
            "metadata": {
              "displayName": "Severity",
              "description": "Severity of the SqlElasticDtuConsumptionPercent Alert"
            },
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "defaultValue": "2"
          },
          "SqlElasticDtuConsumptionPercentWindowSize": {
            "type": "String",
            "metadata": {
              "displayName": "Window Size",
              "description": "Window size for the SqlElasticDtuConsumptionPercent alert"
            },
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "defaultValue": "PT5M"
          },
          "SqlElasticDtuConsumptionPercentEvaluationFrequency": {
            "type": "String",
            "metadata": {
              "displayName": "Evaluation Frequency",
              "description": "Evaluation frequency for the SqlElasticDtuConsumptionPercent alert"
            },
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "defaultValue": "PT1M"
          },
          "SqlElasticDtuConsumptionPercentAutoMitigate": {
            "type": "String",
            "metadata": {
              "displayName": "Auto Mitigate",
              "description": "Auto Mitigate for the SqlElasticDtuConsumptionPercent alert"
            },
            "allowedValues": [
              "true",
              "false"
            ],
            "defaultValue": "true"
          },
          "SqlElasticDtuConsumptionPercentAlertEnabled": {
            "type": "String",
            "metadata": {
              "displayName": "Alert State",
              "description": "Alert state for the SqlElasticDtuConsumptionPercent alert"
            },
            "allowedValues": [
              "true",
              "false"
            ],
            "defaultValue": "true"
          },
          "SqlElasticDtuConsumptionPercentThreshold": {
            "type": "String",
            "metadata": {
              "displayName": "Threshold",
              "description": "Threshold for the SqlElasticDtuConsumptionPercent alert"
            },
            "defaultValue": "90"
          },
          "SqlElasticDtuConsumptionPercentPolicyEffect": {
            "type": "String",
            "metadata": {
              "displayName": "Effect",
              "description": "Effect of the SqlElasticDtuConsumptionPercent policy"
            },
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "defaultValue": "deployIfNotExists"
          },
          "SqlElasticeDtuUsedAlertSeverity": {
            "type": "String",
            "metadata": {
              "displayName": "Severity",
              "description": "Severity of the SqlElasticeDtuUsed Alert"
            },
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "defaultValue": "3"
          },
          "SqlElasticeDtuUsedWindowSize": {
            "type": "String",
            "metadata": {
              "displayName": "Window Size",
              "description": "Window size for the SqlElasticeDtuUsed alert"
            },
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "defaultValue": "PT5M"
          },
          "SqlElasticeDtuUsedEvaluationFrequency": {
            "type": "String",
            "metadata": {
              "displayName": "Evaluation Frequency",
              "description": "Evaluation frequency for the SqlElasticeDtuUsed alert"
            },
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "defaultValue": "PT1M"
          },
          "SqlElasticeDtuUsedAutoMitigate": {
            "type": "String",
            "metadata": {
              "displayName": "Auto Mitigate",
              "description": "Auto Mitigate for the SqlElasticeDtuUsed alert"
            },
            "allowedValues": [
              "true",
              "false"
            ],
            "defaultValue": "true"
          },
          "SqlElasticeDtuUsedAlertEnabled": {
            "type": "String",
            "metadata": {
              "displayName": "Alert State",
              "description": "Alert state for the SqlElasticeDtuUsed alert"
            },
            "allowedValues": [
              "true",
              "false"
            ],
            "defaultValue": "true"
          },
          "SqlElasticeDtuUsedThreshold": {
            "type": "String",
            "metadata": {
              "displayName": "Threshold",
              "description": "Threshold for the SqlElasticeDtuUsed alert"
            },
            "defaultValue": "80"
          },
          "SqlElasticeDtuUsedPolicyEffect": {
            "type": "String",
            "metadata": {
              "displayName": "Effect",
              "description": "Effect of the SqlElasticeDtuUsed policy"
            },
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "defaultValue": "deployIfNotExists"
          },
          "SqlElasticStoragePercentAlertSeverity": {
            "type": "String",
            "metadata": {
              "displayName": "Severity",
              "description": "Severity of the SqlElasticStoragePercent Alert"
            },
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "defaultValue": "3"
          },
          "SqlElasticStoragePercentWindowSize": {
            "type": "String",
            "metadata": {
              "displayName": "Window Size",
              "description": "Window size for the SqlElasticStoragePercent alert"
            },
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "defaultValue": "PT5M"
          },
          "SqlElasticStoragePercentEvaluationFrequency": {
            "type": "String",
            "metadata": {
              "displayName": "Evaluation Frequency",
              "description": "Evaluation frequency for the SqlElasticStoragePercent alert"
            },
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "defaultValue": "PT1M"
          },
          "SqlElasticStoragePercentAutoMitigate": {
            "type": "String",
            "metadata": {
              "displayName": "Auto Mitigate",
              "description": "Auto Mitigate for the SqlElasticStoragePercent alert"
            },
            "allowedValues": [
              "true",
              "false"
            ],
            "defaultValue": "true"
          },
          "SqlElasticStoragePercentAlertEnabled": {
            "type": "String",
            "metadata": {
              "displayName": "Alert State",
              "description": "Alert state for the SqlElasticStoragePercent alert"
            },
            "allowedValues": [
              "true",
              "false"
            ],
            "defaultValue": "true"
          },
          "SqlElasticStoragePercentThreshold": {
            "type": "String",
            "metadata": {
              "displayName": "Threshold",
              "description": "Threshold for the SqlElasticStoragePercent alert"
            },
            "defaultValue": "90"
          },
          "SqlElasticStoragePercentPolicyEffect": {
            "type": "String",
            "metadata": {
              "displayName": "Effect",
              "description": "Effect of the SqlElasticStoragePercent policy"
            },
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "defaultValue": "deployIfNotExists"
          },
          "SqlElasticTempDbLogUsedPercentAlertSeverity": {
            "type": "String",
            "metadata": {
              "displayName": "Severity",
              "description": "Severity of the SqlElasticTempDbLogUsedPercent Alert"
            },
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "defaultValue": "3"
          },
          "SqlElasticTempDbLogUsedPercentWindowSize": {
            "type": "String",
            "metadata": {
              "displayName": "Window Size",
              "description": "Window size for the SqlElasticTempDbLogUsedPercent alert"
            },
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "defaultValue": "PT5M"
          },
          "SqlElasticTempDbLogUsedPercentEvaluationFrequency": {
            "type": "String",
            "metadata": {
              "displayName": "Evaluation Frequency",
              "description": "Evaluation frequency for the SqlElasticTempDbLogUsedPercent alert"
            },
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "defaultValue": "PT5M"
          },
          "SqlElasticTempDbLogUsedPercentAutoMitigate": {
            "type": "String",
            "metadata": {
              "displayName": "Auto Mitigate",
              "description": "Auto Mitigate for the SqlElasticTempDbLogUsedPercent alert"
            },
            "allowedValues": [
              "true",
              "false"
            ],
            "defaultValue": "true"
          },
          "SqlElasticTempDbLogUsedPercentAlertEnabled": {
            "type": "String",
            "metadata": {
              "displayName": "Alert State",
              "description": "Alert state for the SqlElasticTempDbLogUsedPercent alert"
            },
            "allowedValues": [
              "true",
              "false"
            ],
            "defaultValue": "true"
          },
          "SqlElasticTempDbLogUsedPercentThreshold": {
            "type": "String",
            "metadata": {
              "displayName": "Threshold",
              "description": "Threshold for the SqlElasticTempDbLogUsedPercent alert"
            },
            "defaultValue": "80"
          },
          "SqlElasticTempDbLogUsedPercentPolicyEffect": {
            "type": "String",
            "metadata": {
              "displayName": "Effect",
              "description": "Effect of the SqlElasticTempDbLogUsedPercent policy"
            },
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "defaultValue": "deployIfNotExists"
          },
          "SqlElasticWorkersPercentAlertSeverity": {
            "type": "String",
            "metadata": {
              "displayName": "Severity",
              "description": "Severity of the SqlElasticWorkersPercent Alert"
            },
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "defaultValue": "3"
          },
          "SqlElasticWorkersPercentWindowSize": {
            "type": "String",
            "metadata": {
              "displayName": "Window Size",
              "description": "Window size for the SqlElasticWorkersPercent alert"
            },
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "defaultValue": "PT5M"
          },
          "SqlElasticWorkersPercentEvaluationFrequency": {
            "type": "String",
            "metadata": {
              "displayName": "Evaluation Frequency",
              "description": "Evaluation frequency for the SqlElasticWorkersPercent alert"
            },
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "defaultValue": "PT1M"
          },
          "SqlElasticWorkersPercentAutoMitigate": {
            "type": "String",
            "metadata": {
              "displayName": "Auto Mitigate",
              "description": "Auto Mitigate for the SqlElasticWorkersPercent alert"
            },
            "allowedValues": [
              "true",
              "false"
            ],
            "defaultValue": "true"
          },
          "SqlElasticWorkersPercentAlertEnabled": {
            "type": "String",
            "metadata": {
              "displayName": "Alert State",
              "description": "Alert state for the SqlElasticWorkersPercent alert"
            },
            "allowedValues": [
              "true",
              "false"
            ],
            "defaultValue": "true"
          },
          "SqlElasticWorkersPercentThreshold": {
            "type": "String",
            "metadata": {
              "displayName": "Threshold",
              "description": "Threshold for the SqlElasticWorkersPercent alert"
            },
            "defaultValue": "90"
          },
          "SqlElasticWorkersPercentPolicyEffect": {
            "type": "String",
            "metadata": {
              "displayName": "Effect",
              "description": "Effect of the SqlElasticWorkersPercent policy"
            },
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "defaultValue": "deployIfNotExists"
          }
        },
        "policyDefinitions": [
          {
            "policyDefinitionReferenceId": "ALZ_SqlDtuUsed",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/d26f4c8b-0461-4c57-b230-cbd1a5424db1",
            "parameters": {
              "severity": {
                "value": "[[[parameters('SqlDtuUsedAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('SqlDtuUsedWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('SqlDtuUsedEvaluationFrequency')]"
              },
              "effect": {
                "value": "[[[parameters('SqlDtuUsedPolicyEffect')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('SqlDtuUsedAutoMitigate')]"
              },
              "enabled": {
                "value": "[[[parameters('SqlDtuUsedAlertEnabled')]"
              },
              "threshold": {
                "value": "[[[parameters('SqlDtuUsedThreshold')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_SqlDataSpaceUsed",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/86922a27-41bb-4834-bc54-0b602b275597",
            "parameters": {
              "severity": {
                "value": "[[[parameters('SqlDataSpaceUsedAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('SqlDataSpaceUsedWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('SqlDataSpaceUsedEvaluationFrequency')]"
              },
              "effect": {
                "value": "[[[parameters('SqlDataSpaceUsedPolicyEffect')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('SqlDataSpaceUsedAutoMitigate')]"
              },
              "enabled": {
                "value": "[[[parameters('SqlDataSpaceUsedAlertEnabled')]"
              },
              "threshold": {
                "value": "[[[parameters('SqlDataSpaceUsedThreshold')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_SqlDeadlock",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/ce44fc81-3610-4165-a107-9dd4b8ab3972",
            "parameters": {
              "severity": {
                "value": "[[[parameters('SqlDeadlockAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('SqlDeadlockWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('SqlDeadlockEvaluationFrequency')]"
              },
              "effect": {
                "value": "[[[parameters('SqlDeadlockPolicyEffect')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('SqlDeadlockAutoMitigate')]"
              },
              "enabled": {
                "value": "[[[parameters('SqlDeadlockAlertEnabled')]"
              },
              "threshold": {
                "value": "[[[parameters('SqlDeadlockThreshold')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_SqlDtuConsumptionPercent",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/ed2dc2fc-f133-43dd-adf8-233df95d5197",
            "parameters": {
              "severity": {
                "value": "[[[parameters('SqlDtuConsumptionPercentAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('SqlDtuConsumptionPercentWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('SqlDtuConsumptionPercentEvaluationFrequency')]"
              },
              "effect": {
                "value": "[[[parameters('SqlDtuConsumptionPercentPolicyEffect')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('SqlDtuConsumptionPercentAutoMitigate')]"
              },
              "enabled": {
                "value": "[[[parameters('SqlDtuConsumptionPercentAlertEnabled')]"
              },
              "threshold": {
                "value": "[[[parameters('SqlDtuConsumptionPercentThreshold')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_SqlElasticCpuPercent",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/805c4ae5-a852-43bd-ad1c-0f7f381d8f32",
            "parameters": {
              "severity": {
                "value": "[[[parameters('SqlElasticCpuPercentAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('SqlElasticCpuPercentWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('SqlElasticCpuPercentEvaluationFrequency')]"
              },
              "effect": {
                "value": "[[[parameters('SqlElasticCpuPercentPolicyEffect')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('SqlElasticCpuPercentAutoMitigate')]"
              },
              "enabled": {
                "value": "[[[parameters('SqlElasticCpuPercentAlertEnabled')]"
              },
              "threshold": {
                "value": "[[[parameters('SqlElasticCpuPercentThreshold')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_SqlElasticDtuConsumptionPercent",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/5d9075b5-3c19-4cf6-9c2e-50ba4c175691",
            "parameters": {
              "severity": {
                "value": "[[[parameters('SqlElasticDtuConsumptionPercentAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('SqlElasticDtuConsumptionPercentWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('SqlElasticDtuConsumptionPercentEvaluationFrequency')]"
              },
              "effect": {
                "value": "[[[parameters('SqlElasticDtuConsumptionPercentPolicyEffect')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('SqlElasticDtuConsumptionPercentAutoMitigate')]"
              },
              "enabled": {
                "value": "[[[parameters('SqlElasticDtuConsumptionPercentAlertEnabled')]"
              },
              "threshold": {
                "value": "[[[parameters('SqlElasticDtuConsumptionPercentThreshold')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_SqlElasticeDtuUsed",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/16a64053-1905-4d8e-8198-810584cad108",
            "parameters": {
              "severity": {
                "value": "[[[parameters('SqlElasticeDtuUsedAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('SqlElasticeDtuUsedWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('SqlElasticeDtuUsedEvaluationFrequency')]"
              },
              "effect": {
                "value": "[[[parameters('SqlElasticeDtuUsedPolicyEffect')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('SqlElasticeDtuUsedAutoMitigate')]"
              },
              "enabled": {
                "value": "[[[parameters('SqlElasticeDtuUsedAlertEnabled')]"
              },
              "threshold": {
                "value": "[[[parameters('SqlElasticeDtuUsedThreshold')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_SqlElasticStoragePercent",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/88f3cbc0-bcfb-482f-b6f4-709a335afcad",
            "parameters": {
              "severity": {
                "value": "[[[parameters('SqlElasticStoragePercentAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('SqlElasticStoragePercentWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('SqlElasticStoragePercentEvaluationFrequency')]"
              },
              "effect": {
                "value": "[[[parameters('SqlElasticStoragePercentPolicyEffect')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('SqlElasticStoragePercentAutoMitigate')]"
              },
              "enabled": {
                "value": "[[[parameters('SqlElasticStoragePercentAlertEnabled')]"
              },
              "threshold": {
                "value": "[[[parameters('SqlElasticStoragePercentThreshold')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_SqlElasticTempDbLogUsedPercent",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/af66de51-079c-4d34-af92-f52f887642dc",
            "parameters": {
              "severity": {
                "value": "[[[parameters('SqlElasticTempDbLogUsedPercentAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('SqlElasticTempDbLogUsedPercentWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('SqlElasticTempDbLogUsedPercentEvaluationFrequency')]"
              },
              "effect": {
                "value": "[[[parameters('SqlElasticTempDbLogUsedPercentPolicyEffect')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('SqlElasticTempDbLogUsedPercentAutoMitigate')]"
              },
              "enabled": {
                "value": "[[[parameters('SqlElasticTempDbLogUsedPercentAlertEnabled')]"
              },
              "threshold": {
                "value": "[[[parameters('SqlElasticTempDbLogUsedPercentThreshold')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_SqlElasticWorkersPercent",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/1b37038e-6e5c-4463-97d4-8a632251d70e",
            "parameters": {
              "severity": {
                "value": "[[[parameters('SqlElasticWorkersPercentAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('SqlElasticWorkersPercentWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('SqlElasticWorkersPercentEvaluationFrequency')]"
              },
              "effect": {
                "value": "[[[parameters('SqlElasticWorkersPercentPolicyEffect')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('SqlElasticWorkersPercentAutoMitigate')]"
              },
              "enabled": {
                "value": "[[[parameters('SqlElasticWorkersPercentAlertEnabled')]"
              },
              "threshold": {
                "value": "[[[parameters('SqlElasticWorkersPercentThreshold')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          }
        ],
        "policyType": "Custom",
        "policyDefinitionGroups": null
      }
    },
    "$fxv#2": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"ce44fc81-3610-4165-a107-9dd4b8ab3972\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Sql servers databases deadlock Alert\",\r\n    \"description\": \"Policy to Audit/Deploy Sql servers databases deadlock Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.0.0-preview\",\r\n      \"category\": \"Sql\",\r\n      \"preview\": true,\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"3\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT1M\",\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"P1D\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT1M\",\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT1M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Monitoring disabled tag name\",\r\n          \"description\": \"Tag name used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers/databases\"\r\n          },\r\n          {\r\n            \"field\": \"Microsoft.Sql/servers/databases/sku.tier\",\r\n            \"in\": [\"Basic\",\"Standard\",\"Premium\",\"GeneralPurpose\",\"BusinessCritical\",\"Hyperscale\"]\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/metricAlerts\",\r\n          \"name\": \"[[concat(replace(field('fullName'),'/','-'), '-deadlock')]\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricNamespace\",\r\n                \"equals\": \"Microsoft.Sql/servers/databases\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricName\",\r\n                \"equals\": \"deadlock\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricalerts/scopes[*]\",\r\n                \"equals\": \"[[field('id')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricalerts/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft-Azure-Monitor-SingleResourceMultipleMetricCriteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"Total\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].StaticThresholdCriterion.operator\",\r\n                \"equals\": \"GreaterThan\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].StaticThresholdCriterion.threshold\",\r\n                \"equals\": \"[[if(contains(field('tags'), '_amba-deadlock-threshold-Override_'), field('tags._amba-deadlock-threshold-Override_'), parameters('threshold'))]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"resourceName\": {\r\n                    \"type\": \"String\",\r\n                    \"metadata\": {\r\n                      \"displayName\": \"resourceName\",\r\n                      \"description\": \"Name of the resource\"\r\n                    }\r\n                  },\r\n                  \"resourceId\": {\r\n                    \"type\": \"String\",\r\n                    \"metadata\": {\r\n                      \"displayName\": \"resourceId\",\r\n                      \"description\": \"Resource ID of the resource emitting the metric that will be used for the comparison\"\r\n                    }\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Insights/metricAlerts\",\r\n                    \"apiVersion\": \"2018-03-01\",\r\n                    \"name\": \"[[concat(parameters('resourceName'), '-deadlock')]\",\r\n                    \"location\": \"global\",\r\n                    \"tags\": {\r\n                      \"_deployed_by_amba\": true\r\n                    },\r\n                    \"properties\": {\r\n                      \"description\": \"Metric Alert for Sql servers databases deadlock\",\r\n                      \"severity\": \"[[parameters('severity')]\",\r\n                      \"enabled\": \"[[parameters('enabled')]\",\r\n                      \"scopes\": [\r\n                        \"[[parameters('resourceId')]\"\r\n                      ],\r\n                      \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                      \"windowSize\": \"[[parameters('windowSize')]\",\r\n                      \"criteria\": {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"name\": \"deadlock\",\r\n                            \"metricNamespace\": \"Microsoft.Sql/servers/databases\",\r\n                            \"metricName\": \"deadlock\",\r\n                            \"operator\": \"GreaterThan\",\r\n                            \"threshold\": \"[[parameters('threshold')]\",\r\n                            \"timeAggregation\": \"Total\",\r\n                            \"criterionType\": \"StaticThresholdCriterion\"\r\n                          }\r\n                        ],\r\n                        \"odata.type\": \"Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria\"\r\n                      },\r\n                      \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                      \"parameters\": {\r\n                        \"severity\": {\r\n                          \"value\": \"[[parameters('severity')]\"\r\n                        },\r\n                        \"windowSize\": {\r\n                          \"value\": \"[[parameters('windowSize')]\"\r\n                        },\r\n                        \"evaluationFrequency\": {\r\n                          \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                        },\r\n                        \"autoMitigate\": {\r\n                          \"value\": \"[[parameters('autoMitigate')]\"\r\n                        },\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"threshold\": {\r\n                          \"value\": \"[[parameters('threshold')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"resourceName\": {\r\n                  \"value\": \"[[replace(field('fullName'),'/','-')]\"\r\n                },\r\n                \"resourceId\": {\r\n                  \"value\": \"[[field('id')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[if(contains(field('tags'), '_amba-deadlock-threshold-Override_'), field('tags._amba-deadlock-threshold-Override_'), parameters('threshold'))]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#3": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"ed2dc2fc-f133-43dd-adf8-233df95d5197\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Sql servers databases dtu_consumption_percent Alert\",\r\n    \"description\": \"Policy to Audit/Deploy Sql servers databases dtu_consumption_percent Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.0.0-preview\",\r\n      \"category\": \"Sql\",\r\n      \"preview\": true,\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"2\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT1M\",\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"P1D\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT1M\",\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT1M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"80\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Monitoring disabled tag name\",\r\n          \"description\": \"Tag name used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers/databases\"\r\n          },\r\n          {\r\n            \"field\": \"Microsoft.Sql/servers/databases/sku.tier\",\r\n            \"in\": [\r\n              \"Basic\",\r\n              \"Standard\",\r\n              \"Premium\",\r\n              \"GeneralPurpose\",\r\n              \"BusinessCritical\",\r\n              \"Hyperscale\"\r\n            ]\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/metricAlerts\",\r\n          \"name\": \"[[concat(replace(field('fullName'),'/','-'), '-dtu_consumption_percent')]\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricNamespace\",\r\n                \"equals\": \"Microsoft.Sql/servers/databases\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricName\",\r\n                \"equals\": \"dtu_consumption_percent\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricalerts/scopes[*]\",\r\n                \"equals\": \"[[field('id')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricalerts/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft-Azure-Monitor-SingleResourceMultipleMetricCriteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"Average\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].StaticThresholdCriterion.operator\",\r\n                \"equals\": \"GreaterThan\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].StaticThresholdCriterion.threshold\",\r\n                \"equals\": \"[[if(contains(field('tags'), '_amba-dtu_consumption_percent-threshold-Override_'), field('tags._amba-dtu_consumption_percent-threshold-Override_'), parameters('threshold'))]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"resourceName\": {\r\n                    \"type\": \"String\",\r\n                    \"metadata\": {\r\n                      \"displayName\": \"resourceName\",\r\n                      \"description\": \"Name of the resource\"\r\n                    }\r\n                  },\r\n                  \"resourceId\": {\r\n                    \"type\": \"String\",\r\n                    \"metadata\": {\r\n                      \"displayName\": \"resourceId\",\r\n                      \"description\": \"Resource ID of the resource emitting the metric that will be used for the comparison\"\r\n                    }\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Insights/metricAlerts\",\r\n                    \"apiVersion\": \"2018-03-01\",\r\n                    \"name\": \"[[concat(parameters('resourceName'), '-dtu_consumption_percent')]\",\r\n                    \"location\": \"global\",\r\n                    \"tags\": {\r\n                      \"_deployed_by_amba\": true\r\n                    },\r\n                    \"properties\": {\r\n                      \"description\": \"Metric Alert for Sql servers databases dtu_consumption_percent\",\r\n                      \"severity\": \"[[parameters('severity')]\",\r\n                      \"enabled\": \"[[parameters('enabled')]\",\r\n                      \"scopes\": [\r\n                        \"[[parameters('resourceId')]\"\r\n                      ],\r\n                      \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                      \"windowSize\": \"[[parameters('windowSize')]\",\r\n                      \"criteria\": {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"name\": \"dtu_consumption_percent\",\r\n                            \"metricNamespace\": \"Microsoft.Sql/servers/databases\",\r\n                            \"metricName\": \"dtu_consumption_percent\",\r\n                            \"operator\": \"GreaterThan\",\r\n                            \"threshold\": \"[[parameters('threshold')]\",\r\n                            \"timeAggregation\": \"Average\",\r\n                            \"criterionType\": \"StaticThresholdCriterion\"\r\n                          }\r\n                        ],\r\n                        \"odata.type\": \"Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria\"\r\n                      },\r\n                      \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                      \"parameters\": {\r\n                        \"severity\": {\r\n                          \"value\": \"[[parameters('severity')]\"\r\n                        },\r\n                        \"windowSize\": {\r\n                          \"value\": \"[[parameters('windowSize')]\"\r\n                        },\r\n                        \"evaluationFrequency\": {\r\n                          \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                        },\r\n                        \"autoMitigate\": {\r\n                          \"value\": \"[[parameters('autoMitigate')]\"\r\n                        },\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"threshold\": {\r\n                          \"value\": \"[[parameters('threshold')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"resourceName\": {\r\n                  \"value\": \"[[replace(field('fullName'),'/','-')]\"\r\n                },\r\n                \"resourceId\": {\r\n                  \"value\": \"[[field('id')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[if(contains(field('tags'), '_amba-dtu_consumption_percent-threshold-Override_'), field('tags._amba-dtu_consumption_percent-threshold-Override_'), parameters('threshold'))]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#4": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"805c4ae5-a852-43bd-ad1c-0f7f381d8f32\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Sql servers elasticpools cpu_percent Alert\",\r\n    \"description\": \"Policy to Audit/Deploy Sql servers elasticpools cpu_percent Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.0.0-preview\",\r\n      \"category\": \"Sql\",\r\n      \"preview\": true,\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"3\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT1M\",\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"P1D\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT1M\",\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT1M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"90\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Monitoring disabled tag name\",\r\n          \"description\": \"Tag name used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers/elasticpools\"\r\n          },\r\n          {\r\n            \"field\": \"Microsoft.Sql/servers/elasticpools/sku.tier\",\r\n            \"in\": [\"Basic\",\"Standard\",\"Premium\",\"GeneralPurpose\",\"BusinessCritical\",\"Hyperscale\"]\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/metricAlerts\",\r\n          \"name\": \"[[concat(replace(field('fullName'),'/','-'), '-cpu_percent')]\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricNamespace\",\r\n                \"equals\": \"Microsoft.Sql/servers/elasticpools\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricName\",\r\n                \"equals\": \"cpu_percent\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricalerts/scopes[*]\",\r\n                \"equals\": \"[[field('id')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricalerts/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft-Azure-Monitor-SingleResourceMultipleMetricCriteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"Average\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].StaticThresholdCriterion.operator\",\r\n                \"equals\": \"GreaterThan\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].StaticThresholdCriterion.threshold\",\r\n                \"equals\": \"[[if(contains(field('tags'), '_amba-cpu_percent-threshold-Override_'), field('tags._amba-cpu_percent-threshold-Override_'), parameters('threshold'))]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"resourceName\": {\r\n                    \"type\": \"String\",\r\n                    \"metadata\": {\r\n                      \"displayName\": \"resourceName\",\r\n                      \"description\": \"Name of the resource\"\r\n                    }\r\n                  },\r\n                  \"resourceId\": {\r\n                    \"type\": \"String\",\r\n                    \"metadata\": {\r\n                      \"displayName\": \"resourceId\",\r\n                      \"description\": \"Resource ID of the resource emitting the metric that will be used for the comparison\"\r\n                    }\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Insights/metricAlerts\",\r\n                    \"apiVersion\": \"2018-03-01\",\r\n                    \"name\": \"[[concat(parameters('resourceName'), '-cpu_percent')]\",\r\n                    \"location\": \"global\",\r\n                    \"tags\": {\r\n                      \"_deployed_by_amba\": true\r\n                    },\r\n                    \"properties\": {\r\n                      \"description\": \"Metric Alert for Sql servers elasticpools cpu_percent\",\r\n                      \"severity\": \"[[parameters('severity')]\",\r\n                      \"enabled\": \"[[parameters('enabled')]\",\r\n                      \"scopes\": [\r\n                        \"[[parameters('resourceId')]\"\r\n                      ],\r\n                      \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                      \"windowSize\": \"[[parameters('windowSize')]\",\r\n                      \"criteria\": {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"name\": \"cpu_percent\",\r\n                            \"metricNamespace\": \"Microsoft.Sql/servers/elasticpools\",\r\n                            \"metricName\": \"cpu_percent\",\r\n                            \"operator\": \"GreaterThan\",\r\n                            \"threshold\": \"[[parameters('threshold')]\",\r\n                            \"timeAggregation\": \"Average\",\r\n                            \"criterionType\": \"StaticThresholdCriterion\"\r\n                          }\r\n                        ],\r\n                        \"odata.type\": \"Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria\"\r\n                      },\r\n                      \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                      \"parameters\": {\r\n                        \"severity\": {\r\n                          \"value\": \"[[parameters('severity')]\"\r\n                        },\r\n                        \"windowSize\": {\r\n                          \"value\": \"[[parameters('windowSize')]\"\r\n                        },\r\n                        \"evaluationFrequency\": {\r\n                          \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                        },\r\n                        \"autoMitigate\": {\r\n                          \"value\": \"[[parameters('autoMitigate')]\"\r\n                        },\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"threshold\": {\r\n                          \"value\": \"[[parameters('threshold')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"resourceName\": {\r\n                  \"value\": \"[[replace(field('fullName'),'/','-')]\"\r\n                },\r\n                \"resourceId\": {\r\n                  \"value\": \"[[field('id')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[if(contains(field('tags'), '_amba-cpu_percent-threshold-Override_'), field('tags._amba-cpu_percent-threshold-Override_'), parameters('threshold'))]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#5": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"5d9075b5-3c19-4cf6-9c2e-50ba4c175691\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Sql servers elasticpools dtu_consumption_percent Alert\",\r\n    \"description\": \"Policy to Audit/Deploy Sql servers elasticpools dtu_consumption_percent Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.0.0-preview\",\r\n      \"category\": \"Sql\",\r\n      \"preview\": true,\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"3\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT1M\",\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"P1D\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT1M\",\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT1M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"90\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Monitoring disabled tag name\",\r\n          \"description\": \"Tag name used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers/elasticpools\"\r\n          },\r\n          {\r\n            \"field\": \"Microsoft.Sql/servers/elasticpools/sku.tier\",\r\n            \"in\": [\"Basic\",\"Standard\",\"Premium\"]\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/metricAlerts\",\r\n          \"name\": \"[[concat(replace(field('fullName'),'/','-'), '-dtu_consumption_percent')]\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricNamespace\",\r\n                \"equals\": \"Microsoft.Sql/servers/elasticpools\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricName\",\r\n                \"equals\": \"dtu_consumption_percent\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricalerts/scopes[*]\",\r\n                \"equals\": \"[[field('id')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricalerts/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft-Azure-Monitor-SingleResourceMultipleMetricCriteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"Average\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].StaticThresholdCriterion.operator\",\r\n                \"equals\": \"GreaterThan\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].StaticThresholdCriterion.threshold\",\r\n                \"equals\": \"[[if(contains(field('tags'), '_amba-dtu_consumption_percent-threshold-Override_'), field('tags._amba-dtu_consumption_percent-threshold-Override_'), parameters('threshold'))]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"resourceName\": {\r\n                    \"type\": \"String\",\r\n                    \"metadata\": {\r\n                      \"displayName\": \"resourceName\",\r\n                      \"description\": \"Name of the resource\"\r\n                    }\r\n                  },\r\n                  \"resourceId\": {\r\n                    \"type\": \"String\",\r\n                    \"metadata\": {\r\n                      \"displayName\": \"resourceId\",\r\n                      \"description\": \"Resource ID of the resource emitting the metric that will be used for the comparison\"\r\n                    }\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Insights/metricAlerts\",\r\n                    \"apiVersion\": \"2018-03-01\",\r\n                    \"name\": \"[[concat(parameters('resourceName'), '-dtu_consumption_percent')]\",\r\n                    \"location\": \"global\",\r\n                    \"tags\": {\r\n                      \"_deployed_by_amba\": true\r\n                    },\r\n                    \"properties\": {\r\n                      \"description\": \"Metric Alert for Sql servers elasticpools dtu_consumption_percent\",\r\n                      \"severity\": \"[[parameters('severity')]\",\r\n                      \"enabled\": \"[[parameters('enabled')]\",\r\n                      \"scopes\": [\r\n                        \"[[parameters('resourceId')]\"\r\n                      ],\r\n                      \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                      \"windowSize\": \"[[parameters('windowSize')]\",\r\n                      \"criteria\": {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"name\": \"dtu_consumption_percent\",\r\n                            \"metricNamespace\": \"Microsoft.Sql/servers/elasticpools\",\r\n                            \"metricName\": \"dtu_consumption_percent\",\r\n                            \"operator\": \"GreaterThan\",\r\n                            \"threshold\": \"[[parameters('threshold')]\",\r\n                            \"timeAggregation\": \"Average\",\r\n                            \"criterionType\": \"StaticThresholdCriterion\"\r\n                          }\r\n                        ],\r\n                        \"odata.type\": \"Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria\"\r\n                      },\r\n                      \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                      \"parameters\": {\r\n                        \"severity\": {\r\n                          \"value\": \"[[parameters('severity')]\"\r\n                        },\r\n                        \"windowSize\": {\r\n                          \"value\": \"[[parameters('windowSize')]\"\r\n                        },\r\n                        \"evaluationFrequency\": {\r\n                          \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                        },\r\n                        \"autoMitigate\": {\r\n                          \"value\": \"[[parameters('autoMitigate')]\"\r\n                        },\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"threshold\": {\r\n                          \"value\": \"[[parameters('threshold')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"resourceName\": {\r\n                  \"value\": \"[[replace(field('fullName'),'/','-')]\"\r\n                },\r\n                \"resourceId\": {\r\n                  \"value\": \"[[field('id')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[if(contains(field('tags'), '_amba-dtu_consumption_percent-threshold-Override_'), field('tags._amba-dtu_consumption_percent-threshold-Override_'), parameters('threshold'))]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#6": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"16a64053-1905-4d8e-8198-810584cad108\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Sql servers elasticpools eDTU_used Alert\",\r\n    \"description\": \"Policy to Audit/Deploy Sql servers elasticpools eDTU_used Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.0.0-preview\",\r\n      \"category\": \"Sql\",\r\n      \"preview\": true,\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"3\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT1M\",\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"P1D\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT1M\",\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT1M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"80\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Monitoring disabled tag name\",\r\n          \"description\": \"Tag name used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers/elasticpools\"\r\n          },\r\n          {\r\n            \"field\": \"Microsoft.Sql/servers/elasticpools/sku.tier\",\r\n            \"in\": [\"Basic\",\"Standard\",\"Premium\"]\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/metricAlerts\",\r\n          \"name\": \"[[concat(replace(field('fullName'),'/','-'), '-eDTU_used')]\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricNamespace\",\r\n                \"equals\": \"Microsoft.Sql/servers/elasticpools\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricName\",\r\n                \"equals\": \"eDTU_used\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricalerts/scopes[*]\",\r\n                \"equals\": \"[[field('id')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricalerts/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft-Azure-Monitor-SingleResourceMultipleMetricCriteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"Average\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].StaticThresholdCriterion.operator\",\r\n                \"equals\": \"GreaterThan\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].StaticThresholdCriterion.threshold\",\r\n                \"equals\": \"[[if(contains(field('tags'), '_amba-eDTU_used-threshold-Override_'), field('tags._amba-eDTU_used-threshold-Override_'), parameters('threshold'))]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"resourceName\": {\r\n                    \"type\": \"String\",\r\n                    \"metadata\": {\r\n                      \"displayName\": \"resourceName\",\r\n                      \"description\": \"Name of the resource\"\r\n                    }\r\n                  },\r\n                  \"resourceId\": {\r\n                    \"type\": \"String\",\r\n                    \"metadata\": {\r\n                      \"displayName\": \"resourceId\",\r\n                      \"description\": \"Resource ID of the resource emitting the metric that will be used for the comparison\"\r\n                    }\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Insights/metricAlerts\",\r\n                    \"apiVersion\": \"2018-03-01\",\r\n                    \"name\": \"[[concat(parameters('resourceName'), '-eDTU_used')]\",\r\n                    \"location\": \"global\",\r\n                    \"tags\": {\r\n                      \"_deployed_by_amba\": true\r\n                    },\r\n                    \"properties\": {\r\n                      \"description\": \"Metric Alert for Sql servers elasticpools eDTU_used\",\r\n                      \"severity\": \"[[parameters('severity')]\",\r\n                      \"enabled\": \"[[parameters('enabled')]\",\r\n                      \"scopes\": [\r\n                        \"[[parameters('resourceId')]\"\r\n                      ],\r\n                      \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                      \"windowSize\": \"[[parameters('windowSize')]\",\r\n                      \"criteria\": {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"name\": \"eDTU_used\",\r\n                            \"metricNamespace\": \"Microsoft.Sql/servers/elasticpools\",\r\n                            \"metricName\": \"eDTU_used\",\r\n                            \"operator\": \"GreaterThan\",\r\n                            \"threshold\": \"[[parameters('threshold')]\",\r\n                            \"timeAggregation\": \"Average\",\r\n                            \"criterionType\": \"StaticThresholdCriterion\"\r\n                          }\r\n                        ],\r\n                        \"odata.type\": \"Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria\"\r\n                      },\r\n                      \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                      \"parameters\": {\r\n                        \"severity\": {\r\n                          \"value\": \"[[parameters('severity')]\"\r\n                        },\r\n                        \"windowSize\": {\r\n                          \"value\": \"[[parameters('windowSize')]\"\r\n                        },\r\n                        \"evaluationFrequency\": {\r\n                          \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                        },\r\n                        \"autoMitigate\": {\r\n                          \"value\": \"[[parameters('autoMitigate')]\"\r\n                        },\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"threshold\": {\r\n                          \"value\": \"[[parameters('threshold')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"resourceName\": {\r\n                  \"value\": \"[[replace(field('fullName'),'/','-')]\"\r\n                },\r\n                \"resourceId\": {\r\n                  \"value\": \"[[field('id')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[if(contains(field('tags'), '_amba-eDTU_used-threshold-Override_'), field('tags._amba-eDTU_used-threshold-Override_'), parameters('threshold'))]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#7": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"88f3cbc0-bcfb-482f-b6f4-709a335afcad\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Sql servers elasticpools storage_percent Alert\",\r\n    \"description\": \"Policy to Audit/Deploy Sql servers elasticpools storage_percent Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.0.0-preview\",\r\n      \"category\": \"Sql\",\r\n      \"preview\": true,\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"3\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT1M\",\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"P1D\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT1M\",\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT1M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"90\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Monitoring disabled tag name\",\r\n          \"description\": \"Tag name used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers/elasticpools\"\r\n          },\r\n          {\r\n            \"field\": \"Microsoft.Sql/servers/elasticpools/sku.tier\",\r\n            \"in\": [\"Basic\",\"Standard\",\"Premium\",\"GeneralPurpose\",\"BusinessCritical\"]\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/metricAlerts\",\r\n          \"name\": \"[[concat(replace(field('fullName'),'/','-'), '-storage_percent')]\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricNamespace\",\r\n                \"equals\": \"Microsoft.Sql/servers/elasticpools\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricName\",\r\n                \"equals\": \"storage_percent\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricalerts/scopes[*]\",\r\n                \"equals\": \"[[field('id')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricalerts/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft-Azure-Monitor-SingleResourceMultipleMetricCriteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"Average\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].StaticThresholdCriterion.operator\",\r\n                \"equals\": \"GreaterThan\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].StaticThresholdCriterion.threshold\",\r\n                \"equals\": \"[[if(contains(field('tags'), '_amba-storage_percent-threshold-Override_'), field('tags._amba-storage_percent-threshold-Override_'), parameters('threshold'))]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"resourceName\": {\r\n                    \"type\": \"String\",\r\n                    \"metadata\": {\r\n                      \"displayName\": \"resourceName\",\r\n                      \"description\": \"Name of the resource\"\r\n                    }\r\n                  },\r\n                  \"resourceId\": {\r\n                    \"type\": \"String\",\r\n                    \"metadata\": {\r\n                      \"displayName\": \"resourceId\",\r\n                      \"description\": \"Resource ID of the resource emitting the metric that will be used for the comparison\"\r\n                    }\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Insights/metricAlerts\",\r\n                    \"apiVersion\": \"2018-03-01\",\r\n                    \"name\": \"[[concat(parameters('resourceName'), '-storage_percent')]\",\r\n                    \"location\": \"global\",\r\n                    \"tags\": {\r\n                      \"_deployed_by_amba\": true\r\n                    },\r\n                    \"properties\": {\r\n                      \"description\": \"Metric Alert for Sql servers elasticpools storage_percent\",\r\n                      \"severity\": \"[[parameters('severity')]\",\r\n                      \"enabled\": \"[[parameters('enabled')]\",\r\n                      \"scopes\": [\r\n                        \"[[parameters('resourceId')]\"\r\n                      ],\r\n                      \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                      \"windowSize\": \"[[parameters('windowSize')]\",\r\n                      \"criteria\": {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"name\": \"storage_percent\",\r\n                            \"metricNamespace\": \"Microsoft.Sql/servers/elasticpools\",\r\n                            \"metricName\": \"storage_percent\",\r\n                            \"operator\": \"GreaterThan\",\r\n                            \"threshold\": \"[[parameters('threshold')]\",\r\n                            \"timeAggregation\": \"Average\",\r\n                            \"criterionType\": \"StaticThresholdCriterion\"\r\n                          }\r\n                        ],\r\n                        \"odata.type\": \"Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria\"\r\n                      },\r\n                      \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                      \"parameters\": {\r\n                        \"severity\": {\r\n                          \"value\": \"[[parameters('severity')]\"\r\n                        },\r\n                        \"windowSize\": {\r\n                          \"value\": \"[[parameters('windowSize')]\"\r\n                        },\r\n                        \"evaluationFrequency\": {\r\n                          \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                        },\r\n                        \"autoMitigate\": {\r\n                          \"value\": \"[[parameters('autoMitigate')]\"\r\n                        },\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"threshold\": {\r\n                          \"value\": \"[[parameters('threshold')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"resourceName\": {\r\n                  \"value\": \"[[replace(field('fullName'),'/','-')]\"\r\n                },\r\n                \"resourceId\": {\r\n                  \"value\": \"[[field('id')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[if(contains(field('tags'), '_amba-storage_percent-threshold-Override_'), field('tags._amba-storage_percent-threshold-Override_'), parameters('threshold'))]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#8": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"af66de51-079c-4d34-af92-f52f887642dc\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Sql servers elasticpools tempdb_log_used_percent Alert\",\r\n    \"description\": \"Policy to Audit/Deploy Sql servers elasticpools tempdb_log_used_percent Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.0.0-preview\",\r\n      \"category\": \"Sql\",\r\n      \"preview\": true,\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"3\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT1M\",\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"P1D\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT1M\",\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"80\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Monitoring disabled tag name\",\r\n          \"description\": \"Tag name used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers/elasticpools\"\r\n          },\r\n          {\r\n            \"field\": \"Microsoft.Sql/servers/elasticpools/sku.tier\",\r\n            \"in\": [\"Basic\",\"Standard\",\"Premium\",\"GeneralPurpose\",\"BusinessCritical\",\"Hyperscale\"]\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/metricAlerts\",\r\n          \"name\": \"[[concat(replace(field('fullName'),'/','-'), '-tempdb_log_used_percent')]\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricNamespace\",\r\n                \"equals\": \"Microsoft.Sql/servers/elasticpools\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricName\",\r\n                \"equals\": \"tempdb_log_used_percent\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricalerts/scopes[*]\",\r\n                \"equals\": \"[[field('id')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricalerts/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft-Azure-Monitor-SingleResourceMultipleMetricCriteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"Average\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].StaticThresholdCriterion.operator\",\r\n                \"equals\": \"GreaterThan\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].StaticThresholdCriterion.threshold\",\r\n                \"equals\": \"[[if(contains(field('tags'), '_amba-tempdb_log_used_percent-threshold-Override_'), field('tags._amba-tempdb_log_used_percent-threshold-Override_'), parameters('threshold'))]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"resourceName\": {\r\n                    \"type\": \"String\",\r\n                    \"metadata\": {\r\n                      \"displayName\": \"resourceName\",\r\n                      \"description\": \"Name of the resource\"\r\n                    }\r\n                  },\r\n                  \"resourceId\": {\r\n                    \"type\": \"String\",\r\n                    \"metadata\": {\r\n                      \"displayName\": \"resourceId\",\r\n                      \"description\": \"Resource ID of the resource emitting the metric that will be used for the comparison\"\r\n                    }\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Insights/metricAlerts\",\r\n                    \"apiVersion\": \"2018-03-01\",\r\n                    \"name\": \"[[concat(parameters('resourceName'), '-tempdb_log_used_percent')]\",\r\n                    \"location\": \"global\",\r\n                    \"tags\": {\r\n                      \"_deployed_by_amba\": true\r\n                    },\r\n                    \"properties\": {\r\n                      \"description\": \"Metric Alert for Sql servers elasticpools tempdb_log_used_percent\",\r\n                      \"severity\": \"[[parameters('severity')]\",\r\n                      \"enabled\": \"[[parameters('enabled')]\",\r\n                      \"scopes\": [\r\n                        \"[[parameters('resourceId')]\"\r\n                      ],\r\n                      \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                      \"windowSize\": \"[[parameters('windowSize')]\",\r\n                      \"criteria\": {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"name\": \"tempdb_log_used_percent\",\r\n                            \"metricNamespace\": \"Microsoft.Sql/servers/elasticpools\",\r\n                            \"metricName\": \"tempdb_log_used_percent\",\r\n                            \"operator\": \"GreaterThan\",\r\n                            \"threshold\": \"[[parameters('threshold')]\",\r\n                            \"timeAggregation\": \"Average\",\r\n                            \"criterionType\": \"StaticThresholdCriterion\"\r\n                          }\r\n                        ],\r\n                        \"odata.type\": \"Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria\"\r\n                      },\r\n                      \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                      \"parameters\": {\r\n                        \"severity\": {\r\n                          \"value\": \"[[parameters('severity')]\"\r\n                        },\r\n                        \"windowSize\": {\r\n                          \"value\": \"[[parameters('windowSize')]\"\r\n                        },\r\n                        \"evaluationFrequency\": {\r\n                          \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                        },\r\n                        \"autoMitigate\": {\r\n                          \"value\": \"[[parameters('autoMitigate')]\"\r\n                        },\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"threshold\": {\r\n                          \"value\": \"[[parameters('threshold')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"resourceName\": {\r\n                  \"value\": \"[[replace(field('fullName'),'/','-')]\"\r\n                },\r\n                \"resourceId\": {\r\n                  \"value\": \"[[field('id')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[if(contains(field('tags'), '_amba-tempdb_log_used_percent-threshold-Override_'), field('tags._amba-tempdb_log_used_percent-threshold-Override_'), parameters('threshold'))]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#9": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"1b37038e-6e5c-4463-97d4-8a632251d70e\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Sql servers elasticpools workers_percent Alert\",\r\n    \"description\": \"Policy to Audit/Deploy Sql servers elasticpools workers_percent Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.0.0-preview\",\r\n      \"category\": \"Sql\",\r\n      \"preview\": true,\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"3\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT1M\",\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"P1D\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT1M\",\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT1M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"90\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Monitoring disabled tag name\",\r\n          \"description\": \"Tag name used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers/elasticpools\"\r\n          },\r\n          {\r\n            \"field\": \"Microsoft.Sql/servers/elasticpools/sku.tier\",\r\n            \"in\": [\"Basic\",\"Standard\",\"Premium\",\"GeneralPurpose\",\"BusinessCritical\",\"Hyperscale\"]\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/metricAlerts\",\r\n          \"name\": \"[[concat(replace(field('fullName'),'/','-'), '-workers_percent')]\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricNamespace\",\r\n                \"equals\": \"Microsoft.Sql/servers/elasticpools\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricName\",\r\n                \"equals\": \"workers_percent\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricalerts/scopes[*]\",\r\n                \"equals\": \"[[field('id')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricalerts/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft-Azure-Monitor-SingleResourceMultipleMetricCriteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"Average\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].StaticThresholdCriterion.operator\",\r\n                \"equals\": \"GreaterThan\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].StaticThresholdCriterion.threshold\",\r\n                \"equals\": \"[[if(contains(field('tags'), '_amba-workers_percent-threshold-Override_'), field('tags._amba-workers_percent-threshold-Override_'), parameters('threshold'))]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"resourceName\": {\r\n                    \"type\": \"String\",\r\n                    \"metadata\": {\r\n                      \"displayName\": \"resourceName\",\r\n                      \"description\": \"Name of the resource\"\r\n                    }\r\n                  },\r\n                  \"resourceId\": {\r\n                    \"type\": \"String\",\r\n                    \"metadata\": {\r\n                      \"displayName\": \"resourceId\",\r\n                      \"description\": \"Resource ID of the resource emitting the metric that will be used for the comparison\"\r\n                    }\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Insights/metricAlerts\",\r\n                    \"apiVersion\": \"2018-03-01\",\r\n                    \"name\": \"[[concat(parameters('resourceName'), '-workers_percent')]\",\r\n                    \"location\": \"global\",\r\n                    \"tags\": {\r\n                      \"_deployed_by_amba\": true\r\n                    },\r\n                    \"properties\": {\r\n                      \"description\": \"Metric Alert for Sql servers elasticpools workers_percent\",\r\n                      \"severity\": \"[[parameters('severity')]\",\r\n                      \"enabled\": \"[[parameters('enabled')]\",\r\n                      \"scopes\": [\r\n                        \"[[parameters('resourceId')]\"\r\n                      ],\r\n                      \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                      \"windowSize\": \"[[parameters('windowSize')]\",\r\n                      \"criteria\": {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"name\": \"workers_percent\",\r\n                            \"metricNamespace\": \"Microsoft.Sql/servers/elasticpools\",\r\n                            \"metricName\": \"workers_percent\",\r\n                            \"operator\": \"GreaterThan\",\r\n                            \"threshold\": \"[[parameters('threshold')]\",\r\n                            \"timeAggregation\": \"Average\",\r\n                            \"criterionType\": \"StaticThresholdCriterion\"\r\n                          }\r\n                        ],\r\n                        \"odata.type\": \"Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria\"\r\n                      },\r\n                      \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                      \"parameters\": {\r\n                        \"severity\": {\r\n                          \"value\": \"[[parameters('severity')]\"\r\n                        },\r\n                        \"windowSize\": {\r\n                          \"value\": \"[[parameters('windowSize')]\"\r\n                        },\r\n                        \"evaluationFrequency\": {\r\n                          \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                        },\r\n                        \"autoMitigate\": {\r\n                          \"value\": \"[[parameters('autoMitigate')]\"\r\n                        },\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"threshold\": {\r\n                          \"value\": \"[[parameters('threshold')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"resourceName\": {\r\n                  \"value\": \"[[replace(field('fullName'),'/','-')]\"\r\n                },\r\n                \"resourceId\": {\r\n                  \"value\": \"[[field('id')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[if(contains(field('tags'), '_amba-workers_percent-threshold-Override_'), field('tags._amba-workers_percent-threshold-Override_'), parameters('threshold'))]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "cloudEnv": "[environment().name]",
    "defaultDeploymentLocationByCloudType": {
      "AzureCloud": "northeurope",
      "AzureChinaCloud": "chinaeast2",
      "AzureUSGovernment": "usgovvirginia"
    },
    "templateVars": {
      "scope": "/providers/Microsoft.Management/managementGroups/contoso",
      "defaultDeploymentLocation": "\"location\": \"northeurope\"",
      "localizedDeploymentLocation": "[format('\"location\": \"{0}\"', variables('defaultDeploymentLocationByCloudType')[variables('cloudEnv')])]"
    },
    "targetDeploymentLocationByCloudType": {
      "AzureCloud": "[coalesce(parameters('location'), 'northeurope')]",
      "AzureChinaCloud": "[coalesce(parameters('location'), 'chinaeast2')]",
      "AzureUSGovernment": "[coalesce(parameters('location'), 'usgovvirginia')]"
    },
    "deploymentLocation": "[format('\"location\": \"{0}\"', variables('targetDeploymentLocationByCloudType')[variables('cloudEnv')])]",
    "loadPolicyDefinitions": {
      "All": [
        "[variables('$fxv#0')]",
        "[variables('$fxv#1')]",
        "[variables('$fxv#2')]",
        "[variables('$fxv#3')]",
        "[variables('$fxv#4')]",
        "[variables('$fxv#5')]",
        "[variables('$fxv#6')]",
        "[variables('$fxv#7')]",
        "[variables('$fxv#8')]",
        "[variables('$fxv#9')]"
      ],
      "AzureCloud": [],
      "AzureChinaCloud": [],
      "AzureUSGovernment": []
    },
    "loadPolicySetDefinitions": {
      "All": [
        "[string(variables('$fxv#10'))]"
      ],
      "AzureCloud": [],
      "AzureChinaCloud": [],
      "AzureUSGovernment": []
    },
    "policyDefinitionsByCloudType": {
      "All": "[variables('policyDefinitionsAll')]",
      "AzureCloud": "[variables('policyDefinitionsAzureCloud')]",
      "AzureChinaCloud": "[variables('policyDefinitionsAzureChinaCloud')]",
      "AzureUSGovernment": "[variables('policyDefinitionsAzureUSGovernment')]"
    },
    "policySetDefinitionsByCloudType": {
      "All": "[variables('policySetDefinitionsAll')]",
      "AzureCloud": "[variables('policySetDefinitionsAzureCloud')]",
      "AzureChinaCloud": "[variables('policySetDefinitionsAzureChinaCloud')]",
      "AzureUSGovernment": "[variables('policySetDefinitionsAzureUSGovernment')]"
    },
    "policyDefinitions": "[concat(variables('policyDefinitionsByCloudType').All, variables('policyDefinitionsByCloudType')[variables('cloudEnv')])]",
    "policySetDefinitions": "[concat(variables('policySetDefinitionsByCloudType').All, variables('policySetDefinitionsByCloudType')[variables('cloudEnv')])]"
  },
  "resources": [
    {
      "copy": {
        "name": "PolicyDefinitions",
        "count": "[length(variables('policyDefinitions'))]"
      },
      "type": "Microsoft.Authorization/policyDefinitions",
      "apiVersion": "2020-09-01",
      "name": "[variables('policyDefinitions')[copyIndex()].name]",
      "properties": {
        "description": "[variables('policyDefinitions')[copyIndex()].properties.description]",
        "displayName": "[variables('policyDefinitions')[copyIndex()].properties.displayName]",
        "metadata": "[variables('policyDefinitions')[copyIndex()].properties.metadata]",
        "mode": "[variables('policyDefinitions')[copyIndex()].properties.mode]",
        "parameters": "[variables('policyDefinitions')[copyIndex()].properties.parameters]",
        "policyType": "[variables('policyDefinitions')[copyIndex()].properties.policyType]",
        "policyRule": "[variables('policyDefinitions')[copyIndex()].properties.policyRule]"
      }
    },
    {
      "copy": {
        "name": "PolicySetDefinitions",
        "count": "[length(variables('policySetDefinitions'))]"
      },
      "type": "Microsoft.Authorization/policySetDefinitions",
      "apiVersion": "2020-09-01",
      "name": "[variables('policySetDefinitions')[copyIndex()].name]",
      "properties": {
        "description": "[variables('policySetDefinitions')[copyIndex()].properties.description]",
        "displayName": "[variables('policySetDefinitions')[copyIndex()].properties.displayName]",
        "metadata": "[variables('policySetDefinitions')[copyIndex()].properties.metadata]",
        "parameters": "[variables('policySetDefinitions')[copyIndex()].properties.parameters]",
        "policyType": "[variables('policySetDefinitions')[copyIndex()].properties.policyType]",
        "policyDefinitions": "[variables('policySetDefinitions')[copyIndex()].properties.policyDefinitions]",
        "policyDefinitionGroups": "[variables('policySetDefinitions')[copyIndex()].properties.policyDefinitionGroups]"
      },
      "dependsOn": [
        "PolicyDefinitions"
      ]
    }
  ],
  "outputs": {
    "policyDefinitionNames": {
      "type": "array",
      "copy": {
        "count": "[length(variables('policyDefinitions'))]",
        "input": "[variables('policyDefinitions')[copyIndex()].name]"
      }
    },
    "policySetDefinitionNames": {
      "type": "array",
      "copy": {
        "count": "[length(variables('policySetDefinitions'))]",
        "input": "[variables('policySetDefinitions')[copyIndex()].name]"
      }
    }
  }
}